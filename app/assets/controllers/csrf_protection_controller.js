const nameCheck=/^[-_a-zA-Z0-9]{4,22}$/,tokenCheck=/^[-_\/+a-zA-Z0-9]{24,}$/;document.addEventListener("submit",(function(t){generateCsrfToken(t.target)}),!0),document.addEventListener("turbo:submit-start",(function(t){const e=generateCsrfHeaders(t.detail.formSubmission.formElement);Object.keys(e).map((function(o){t.detail.formSubmission.fetchRequest.headers[o]=e[o]}))})),document.addEventListener("turbo:submit-end",(function(t){removeCsrfToken(t.detail.formSubmission.formElement)}));export function generateCsrfToken(t){const e=t.querySelector('input[data-controller="csrf-protection"], input[name="_csrf_token"]');if(!e)return;let o=e.getAttribute("data-csrf-protection-cookie-value"),n=e.value;if(!o&&nameCheck.test(n)&&(e.setAttribute("data-csrf-protection-cookie-value",o=n),e.defaultValue=n=btoa(String.fromCharCode.apply(null,(window.crypto||window.msCrypto).getRandomValues(new Uint8Array(18)))),e.dispatchEvent(new Event("change",{bubbles:!0}))),o&&tokenCheck.test(n)){const t=o+"_"+n+"="+o+"; path=/; samesite=strict";document.cookie="https:"===window.location.protocol?"__Host-"+t+"; secure":t}}export function generateCsrfHeaders(t){const e={},o=t.querySelector('input[data-controller="csrf-protection"], input[name="_csrf_token"]');if(!o)return e;const n=o.getAttribute("data-csrf-protection-cookie-value");return tokenCheck.test(o.value)&&nameCheck.test(n)&&(e[n]=o.value),e}export function removeCsrfToken(t){const e=t.querySelector('input[data-controller="csrf-protection"], input[name="_csrf_token"]');if(!e)return;const o=e.getAttribute("data-csrf-protection-cookie-value");if(tokenCheck.test(e.value)&&nameCheck.test(o)){const t=o+"_"+e.value+"=0; path=/; samesite=strict; max-age=0";document.cookie="https:"===window.location.protocol?"__Host-"+t+"; secure":t}}export default"csrf-protection-controller";